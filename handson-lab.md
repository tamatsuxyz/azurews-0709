**目次**

* 演習 1: Azure にリソースを展開する
    * タスク 1: Azure 仮想マシンを作成する
    * タスク 2: Azure 仮想マシンにログインする
    * タスク 3: Azure 仮想マシンを管理する
    * タスク 4: Azure 仮想マシンをセキュリティで保護する

* 演習 2: ストレージ
    * タスク 1: Azure Storage を展開する
    * タスク 2: Azure Storage Explorer を使ってファイルをアップロードする
    * タスク 3: Azure CLI を使ってファイルをアップロードする
    * タスク 4: Private Endpoint を設定して、Storage リソースを保護する
    * タスク 5: Azure Storage の高度な設定を実施する

* ラボのクリーンアップ: リソース グループを削除する


**概要**
---
仮想の会社「Contoso Inc.」は、急成長中のテクノロジー企業で、主にクラウドベースのソリューションを提供しています。Contoso Inc. は、オンプレミスのインフラストラクチャから Microsoft Azure クラウドへの移行を進めており、その過程でさまざまな Microsoft Azure サービスを活用する計画です。

Contoso Inc. は、社内外のリソースを効率的に管理し、セキュリティを強化し、スケーラブルなストレージソリューションを構築することを目指しています。このハンズオンラボでは、Contoso Inc. の IT チームの一員として、Microsoft Azure の基本的な設定や管理を学びます。


**ソリューション アーキテクチャ**
---
以下の図は、このラボで構築するシステムのアーキテクチャを示しています。// Web サーバー、PostgreSQL、だけから始めて、東日本リージョンに構築します。次に、この環境を西日本リージョンのセカンダリ サイトに拡張し、Web 層とデータベース層の両方に可用性ソリューションを追加します。//

![SolutionOverview](https://raw.githubusercontent.com/tamatsuxyz/azurews/main/images/SolutionOverview.png)
---

## 演習 1: Azure に仮想マシンを展開する
---
Contoso Inc. は新しいプロジェクト「Project Phoenix」を立ち上げ、Azure 上に新しい仮想マシンを展開して開発環境を構築する必要があります。このプロジェクトは、AI を活用した次世代の顧客サポートシステムの開発を目指しています。チームはまず開発者が使う環境を整えるために、迅速に仮想マシンをデプロイする必要があります。



### タスク 1: Azure 仮想マシンを作成する
Contoso Inc. の IT チームは、まず最初に開発者用の仮想マシンをAzureポータルを使って作成します。

1. Web ブラウザで Azure ポータルを開きます。(https://portal.azure.com)
   
   認証画面が表示されたら、サブスクリプションの資格情報を入力して、ログインします。
2. [**＋リソースの作成**] をクリックします。
3. [**Windows Server 2019 Datacenter**] をクリックします。
4. **基本** タブの項目では、以下の情報を入力します。入力後、[**次: ディスク**] ボタンをクリックします。
    * リソース グループ: **Prefix**-azurews (既存）

        ※ タスク1 で作成したリソース グループ名を選択します。

    * 仮想マシン名: WebVM01
    * 地域: 東日本
    * 可用性オプション: 可用性セット
    * 可用性セット: avs-web (新規作成)

        ※可用性セットを新規作成する際に、以下の情報を入力します。
        * 名前: avs-web
    * サイズ: Standard_D2s_v5
    * ユーザー名: azlabadmin
    * パスワード/パスワードの確認: (**任意のパスワードを入力**)
5. **ディスク** タブの項目では、以下の情報を入力します。入力後、[**次: ネットワーク**] ボタンをクリックします。
    * OS のディスクの種類: Standard HDD
6. **ネットワーク** タブの項目では、以下の情報を入力します。入力後、[**確認および作成**] ボタンをクリックします。
    * 仮想ネットワーク: jpevnet（新規作成）

        ※仮想ネットワークを新規作成する際に、以下の情報を入力します。
        * アドレス範囲: 10.0.0.0/**16**
        * サブネット名: web
        * アドレス空間: 10.0.0.0/**24**
7. **検証に成功しました** のメッセージが出力されたら、[**作成**] ボタンをクリックします。
8. **デプロイが完了しました** のメッセージが出力されたら、[**リソースに移動**] ボタンをクリックします。

9. 作成した仮想マシンの情報を確認します



### タスク 2: Azure 仮想マシンにログインする
作成した仮想マシンにリモート デスクトップ（RDP）を使用してログインし、基本的な設定を行います。

1. a
2. b
3. c

> 補足
>
> 作業端末のネットワーク環境がインターネット向けの RDP 接続ができない場合、Azure Bastion を使用することでブラウザベースのリモートログインが可能です。Azure Bastion を構成する手順については、以下の公開技術情報を参照してください。
>
>
> クイックスタート: ブラウザーを使用してプライベート IP アドレスで VM に安全に接続する
>
> https://docs.microsoft.com/ja-jp/azure/bastion/quickstart-host-portal


### タスク 3: Azure 仮想マシンを管理する
Azure ポータルや Azure CLI を使って、仮想マシンの管理タスクを実行します。例えば、リソースの監視や設定変更などです。





### タスク 4: Azure 仮想マシンをセキュリティで保護する
Contoso Inc. のセキュリティ ポリシーに従って、仮想マシンのセキュリティを強化します。ネットワーク セキュリティ グループ（NSG）の設定や Defender for Security を活用します。





## 演習 2: ストレージ
---
Contoso Inc. は、顧客からのフィードバックやサポートログを効率的に保存し、分析できるようにするために、Azure Storage を利用します。新しいプロジェクト「Data Vault」では、大量のデータを安全に保存し、効率的にアクセスできるストレージソリューションを構築する必要があります。

### タスク 1: Azure Storage を展開する
Contoso Inc. の IT チームは、まず Azure ポータルを使って Azure Storage アカウントを作成します。

1. Azure ポータル上で [**＋リソースの作成**] をクリックします。
2. [**Windows Server 2019 Datacenter**] をクリックします。


### タスク 2 Azure Storage Explorer を使ってファイルをアップロードする
作成した Storage アカウントに対して、Azure Storage Explorer を使用してファイルをアップロードします。

1.
2. 以下の URL から Azure Storage Explorer をダウンロードします
   
　　https://azure.microsoft.com/ja-jp/products/storage/storage-explorer

　「今すぐダウンロード」を選択し「Windows」をクリックします

3. 「StorageExplorer-windows-x64.exe」をクリックして、インストールします
4. デスクトップから 「Storage Explorer」をクリックします
5. 

### タスク 3: Azure CLI を使ってファイルをアップロードする
Azure CLIを使用して、ストレージアカウントにファイルをアップロードし、CLI操作に慣れます。

1. 
https://learn.microsoft.com/ja-jp/cli/azure/install-azure-cli-windows?tabs=azure-cli

「Azure CLI の最新の MSI (64 ビット)」をクリックします

2.「azure-cli-2.61.0-x64.msi」をクリックして、Azure CLI をインストールします

3. a

4.


### タスク 4: Private Endpoint を設定して、Storage リソースを保護する
ストレージアカウントへのアクセスを制限するために、Private Endpoint を設定します。これにより、Contoso Inc. のデータはインターネットを経由せず、安全にアクセスできます。

プライベート エンドポイントでは、VNet 内の他のリソースと同様に、データベース サーバーへの接続に使用できるサブネット内のプライベート IP が公開されるため、
他のデータベース サーバーへの接続を禁止しつつ、自信が所有するデータベース サーバーだけにアクセスを許可するという構成がとれます。

> [*注意*]
>
> プライベート リンク機能は、汎用またはメモリ最適化のいずれかの価格レベルの Azure Database for PostgreSQL サーバーでのみ使用可能です。

1. Azure ポータル上部の、検索欄に [Private Link] と入力し、表示された [Private Link] をクリックします。
2. [プライベート エンドポイントの作成] ボタンを選択します。
3. **基本**タブで以下の情報を入力します。入力後は、[次:リソース] をクリックします。
    * リソース グループ: **Prefix**-azurews (既存）
    * 名前: jpepsqlPrivateEndpoint
    * リージョン: 東日本
4. **リソース**タブで、以下の情報を入力します。入力後は、[次:構成] をクリックします。
    * リソースの種類: Microsoft.DBforPostgreSQL/servers
    * リソース: **Prefix**-jpepsql
    * 対象 サブリソース: postgresqlServer
5. **構成**タブで以下の情報を入力します。入力後は、[**確認および作成**] をクリックします。
    * 仮想ネットワーク: jpevnet
    * サブネット: web
    * プライベート DNS ゾーンと統合する: はい
    * プライベート DNS ゾーン: （新規）privatelink.postgres.database.azure.com
6. **検証に成功しました** のメッセージが出力されたら、 [**作成**] ボタンをクリックします。
7. **デプロイが完了しました** のメッセージが出力されることを確認します。
8. WebVM01 に RDP 接続でログインします。（手順は、演習 1 - タスク 3 を参照してください）
9. コマンドプロンプトを開いて以下を実行します。


### タスク 5: Azure Storage の高度な設定を実施する
Contoso Inc. のニーズに合わせて、Azure Storage の高度な設定（例えば、レプリケーションやアクセス制御）を行います。


## ラボのクリーンアップ: リソース グループを削除する

1. [リソース グループ] を選択します。
2. xx-azurews リソース グループを開きます。
3. [リソース グループの削除] をクリックします。

    ※確認メッセージが表示されたら、リソースグループ名を入力し [削除] ボタンをクリックします。

4. 通知メッセージにて、リソース グループの削除が正常に完了したことを確認します。